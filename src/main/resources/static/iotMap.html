<!DOCTYPE html>
<html lang="zh" style="width: 100%; height: 100%;">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性能测试示例</title>
</head>
<body style="width: 100%; height: 100%;margin:0; overflow: hidden;">
<div id="fengMap" style="width: 100%; height: 100%;" ></div>
<div id="info" style="width: 100%;height: 180px;position: absolute; bottom: 0;"></div>
<script src="lib/fengmap.min.js"></script>

<script>
    //获取版本号,设置title
    document.title='性能测试示例-'+fengmap.VERSION;

    //定义全局map变量
    var map;
    var fmapID = 'iotlab';
    var imgMarkerLayer=null;

    window.onload = function() {

        map = new fengmap.FMMap({
            //渲染dom
            container: document.getElementById('fengMap'),
//            地图数据位置
            mapServerURL: './data/' + fmapID,
//            主题数据位置
            mapThemeURL: './data/theme',
            //设置主题
            defaultThemeName: 'iotlab',
            // 默认比例尺级别设置为20级
            defaultMapScaleLevel: 23,
            //对不可见图层启用透明设置 默认为true
            focusAlphaMode: true,
            //关闭聚焦层切换的动画显示
            focusAnimateMode: false,
            //对不聚焦图层启用透明设置，当focusAlphaMode = true时有效
            focusAlpha: 0,
            //开启2维，3维切换的动画显示
            viewModeAnimateMode: true,
            //初始二维还是三维状态,默认是3D状态
            //defaultViewMode: fengmap.FMViewMode.MODE_2D,
            //设置倾斜角，默认倾斜角为60度
            defaultTiltAngle: 30,
            //初始指北针的偏移量
            compassOffset: [10, 20],
            //开发者申请应用下web服务的key
            key: '34a37f702ce7100a9043b5ef4d583500',
            //开发者申请应用名称
            appName: '蜂鸟室内地图测试',
        });

        //打开Fengmap服务器的地图数据和主题
        map.openMapById(fmapID);

        //设置鼠标滚动放大缩小比例，默认为0.4
        map.controls.zoomSpeed = 0.6;
        //显示指北针
        map.showCompass = true;

        //地图加载完成回调
        map.on('loadComplete',function() {
            //循环添加ImageMarker
            for(var i=0;i<1000;i++){
                addMarkers();
            }
        });

        //返回一个随机数坐标
        function makeRandomMapCoord(){
            var tmpX= map.maxX-map.minX+1;
            var tmpY= map.maxY- map.minY+1;
            return {
                x:Math.floor(Math.random() * tmpX + map.minX),
                y:Math.floor(Math.random() * tmpY + map.minY)
            };
        }


        //添加Marker
        function addMarkers() {

            if(imgMarkerLayer==null){
                var group = map.getFMGroup(map.groupIDs[0]);
                //返回当前层中第一个imageMarkerLayer,如果没有，则自动创建
                imgMarkerLayer = group.getOrCreateLayer('imageMarker');
            }
            var randomCoord= makeRandomMapCoord();
            //图标标注对象，默认位置为该楼层中心点
            var imgMarker = new fengmap.FMImageMarker({
                //设置坐标，在地图范围内随机生成
                x: randomCoord.x,
                y: randomCoord.y,
                //设置图片路径
                url: 'image/black_circle.png',
                //设置图片显示尺寸
                size: 16,
                callback: function() {
                    // 在图片载入完成后，设置 "一直可见"
                    imgMarker.alwaysShow();
                }
            });

            imgMarkerLayer.addMarker(imgMarker);
        };

    };
</script>
</body>
</html>